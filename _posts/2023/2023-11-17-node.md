---
layout: post
title:  "Node.js"
date:   2023-11-17
categories: node
permalink: /:categories/nodejs
---


<p>It is a general view of Node.JS with main commands and concepts</p>


<table>
  <tr>
    <td><a href="#jspre">JavaScript Prerequisites (7%)</a></td>
    <td><a href="#bufferandstreams">Buffer and Streams (11%)</a></td>
    <td><a href="#controlflow">Control flow (12%)</a></td>
  </tr>
  <tr>
    <td><a href="#childprocess">Child Process (8%)</a></td>
    <td><a href="#diagnostics">Diagnostics (6%)</a></td>
    <td><a href="#error">Error Handling (8%)</a></td>
  </tr>
</table>

<h2>Introduction</h2>

<p><b>Install:</b> from the <a href="https://nodejs.org/en">official page</a> or from some package manager (apt-get/brew)</p>

<p><b>nvm:</b> <a href="https://github.com/nvm-sh/nvm">Node version manager</a></p>

{% highlight ruby %}
$ nvm install 20                        // install version 20
$ node -v                               // check node version
$ npm -v                                // version of npm installed with node
$ node --help                           // list of possible options
$ node --v8-options                     // options to change engine
$ node --check myApp.js                 // check the syntax 
$ node -p "2+2"                         // Dynamic evaluation: p -> print -> print 4
$ node -e "2+2"                         // Dynamic evaluation: e -> eval  -> evaluate but not print     
$ node --require ./jsmodule.js myApp.js // preloading CommonJS module used in myApp.js
$ node --stack-trace-limit=101 myApp.js // print more lines from error (default is 10) 
{% endhighlight %}

<p><b>debug:</b> inspect code</p>

{% highlight ruby %}
// Chrome detect the debugger process
// chrome://inspect -> Remote Target -> Inspect -> DevTools is open connected with Node process -> Sources tab
// "Pause on caught exceptions" can be checked to stop in point of the exception
$ node --inspect app.js.        

// stop in active breakpoints
// breakpoints can be added by selecting a line in the code by DevTools or adding the key word debugger
$ node --inspect-brk app.js.    
{% endhighlight %}


<br />
<h2 id="jspre">JavaScript Prerequisites (7%)</h2>

<p>Primitives in JS: null, undefined, Number, BigInt [1n], String, Boolean, Symbol [Symbol('description'), Symbol.for('namespace')]</p>

<ul>
  <li>null: absence of an object</li>
  <li>undefined: absence of a defined value.</li>
  <li>string: can use single or double quotes, or backticks (it is a template string)</li>
  <li>Symbols: built-in object whose constructor returns a symbol which is unique. It can be used as unique identifier keys in objects<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol">[1]</a></li>
</ul>

<p><b>Prototype:</b> it is the built-in property that every object has. It is a mechanism by which JavaScript objects inherit features from one another. <a href="https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Objects/Object_prototypes">[2]</a><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Inheritance_and_the_prototype_chain">[3]</a><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Inheritance_and_the_prototype_chain#inspecting_prototypes_a_deeper_dive">[4]</a></p>
  {% highlight ruby %}
  function doSomething() {}
  doSomething.prototype.foo = "bar"; 
  const doSomeInstancing = new doSomething();
  doSomeInstancing.prop = "some value"; 
  console.log(doSomeInstancing);
  // Result
  { prop: "some value",
  [[Prototype]]: {
    foo: "bar",
    constructor: ƒ doSomething(),
    [[Prototype]]: {
      constructor: ƒ Object(),
      hasOwnProperty: ƒ hasOwnProperty(),
      isPrototypeOf: ƒ isPrototypeOf(),
      propertyIsEnumerable: ƒ propertyIsEnumerable(),
      toLocaleString: ƒ toLocaleString(),
      toString: ƒ toString(),
      valueOf: ƒ valueOf()
    }}}
  {% endhighlight %}


<p><b>Function:</b> is an object</p>

<ul>
  <li>Function assigned to an object: 'this' refers the function called. 'this' context changes to the object that call internal funcion.</li>
  <li>The call method that exist to every function can be used to set the 'this' context</li>
  <li>Lambda functions (arrow function) do not have their own this context. 'this' inside the lambda function is the context of the nearest parent non-lambda function</li>
  <li>Lambda function does not have prototype: typeof normalFunc.prototype is 'object' and typeof lambdaFunc.prototype is 'undefined'</li>
</ul>

{% highlight ruby %}
// Ex1: creating as funcion
const A = function(att1, att2) {
    this.att2 = att1;
    this.att2 = att2;
}
A.prototype.myMethod = function () {
    this.att2 += 10;
    console.log(`${this.att1} :: ${this.att2}`);
}
const objA = new A('A is', 2);
objA.myMethod();

// Ex2: creating as class
class B {
  constructor(att1,att2){
    this.att2 = att1;
    this.att2 = att2;   
  }
  myMethod() {
    this.att2 += 10;
    console.log(`${this.att1} :: ${this.att2}`);   
  }
}
const objB = new B('B is', 3);
objB.myMethod();
{% endhighlight %}


<p><b>Prototypal Inheritance:</b> it is a chain of prototype. It can be created by different approache like: functional, contructor functions and class-syntax contructor. When use MyObject.prototype.myFunciont, it will be one object myFunction to all objectos from MyObject. Bad practices create a method inside the function constructor.</p>

<p><u><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Inheritance_and_the_prototype_chain#inheriting_methods">Functional</a></u></p>

{% highlight ruby %}
'use strict'
// the prototype of a is Object.prototype
const a = { attA: function () { console.log(this.name + ': A') } }

// a is a prototype of b.
// b.__proto__ ===  a
const b = Object.create(a, {attB: { value: function() { console.log(this.name + ': B') } } })

// b is a prototype of c.
const c = Object.create(b, { name: {value: 'C'} })

c.attB() // prints "C: B"
c.attA() // prints "C: A"

console.log(Object.getPrototypeOf(c) === b) //true
console.log(Object.getPrototypeOf(b) === a) //true

// Object.create -> First argument is the prototype. 
// Second argument is Properties Descriptor
// Object.getOwnPropertyDescriptor
// property value can be 'value', 'get' and 'set'.
{% endhighlight %}

<p><u><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Inheritance_and_the_prototype_chain#constructors">Constructor function</a>: Can be attiched by the use of the 'new' keywod</u></p>

{% highlight ruby %}
'use strict'
function A (name){ this.name = name}
A.prototype.attA = function() {console.log(this.name + ':A')}

function B(name){A.call(this, name + ':B-A')}
B.prototype.attB = function() {console.log(this.name + ':B')}

// Set the `[[Prototype]]` of `B.prototype` to `A.prototype`
Object.setPrototypeOf(B.prototype, A.prototype)

// c -> B.prototype -> A.prototype -> Object.prototype
// {} <--> new B()
const c = new B('NEW'); 

c.attB() // NEW:B-A:B
c.attA() // NEW:B-A:A

console.log(Object.getPrototypeOf(B) === A.prototype) //false
console.log(Object.getPrototypeOf(c) === B.prototype) //true
console.log(Object.getPrototypeOf(c) === A.prototype) //false
console.log(Object.getPrototypeOf(B) === Object.getPrototypeOf(A)) //true

// B.prototype is prototype of linked objects
// __proto__ is how JS knows internally that c object is connected to B.prototype
console.log(c.__proto__ === B.protptype) //true
console.log(B.prototype.isPrototypeOf(c)) //true
console.log(B.prototype.isPrototypeOf(B)) //false
console.dir(B.prototype.constructor)

// [[Prototype]] is used to designate the prototype of someObject
// func.prototype specifies the [[Prototype]] to be assigned to all instances of objects created by the given function when used as a constructor.
{% endhighlight %}


<p><u><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Inheritance_and_the_prototype_chain#with_classes">Class-Syntax Constructor</a>: Class is a syntactic sugar to creates a function. it creates prototype chains. All method created in the class is added to the prototype object.</u></p>

{% highlight ruby %}
class A{}
class B extends A{}
const c = new B();

console.log(Object.getPrototypeOf(c) === B.prototype) //true
console.log(Object.getPrototypeOf(B.prototype) === A.prototype) //true

// function constructor  vs constructor
A(att){this.att = att}  <--> class A {constructor(att){this.att = att}}
A.call(this, name + ':A') <--> super(name + ':A')
{% endhighlight %}

<h2 id="bufferandstreams">Buffer and Streams (11%)</h2>

<p><b>Definition:</b>Buffer objects are used to represent a fixed-length sequence of bytes. <a href="https://nodejs.org/dist/latest-v18.x/docs/api/buffer.html">[1]</a></p>

<p><b><u>Allocation</u></b></p>

{% highlight ruby %}
// allocate a buffer of 10 bytes with zeros
$ node -p "Buffer.alloc(10)"       // <Buffer 00 00 00 00 00 00 00 00 00 00> :: hexadecimal
// allocate a buffer of 10 bytes with 1
$ node -p "Buffer.alloc(10,1)"     // <Buffer 01 01 01 01 01 01 01 01 01 01> :: hexadecimal
// Creates a Buffer containing the bytes [1, 2, 3]
$ node -p "Buffer.from([1, 2, 3])" // <Buffer 01 02 03>  
{% endhighlight %}

<p style="text-align: justify;"><em>The 'new' to create a buffer is deprecated. It used to have the Buffer.unsafeAlloc which means unallocated memory. The buffer can contain fragments of previously deleted data. It is used to performance porpose.</em></p>

<p><b><u>Arrays</u></b></p>

<p>Different views of a buffer: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array">[2]</a><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Typed_arrays">[3]</a></p>
<ul>
  <li>ArrayBuffer -> Float64Array -> 8 bytes -> 64-bit floating point number</li>
  <li>Int32Array -> 4 bytes -> 32 bits -> signed integer</li>
  <li>Uint8Array -> each byte is unsigned integer (0-255)</li>
  <li>Buffer is subclass of Uint8Array: an object is Buffer and Uint8Array</li>
  <li>Buffer.prototype.slice (buffer instance with reference to original data) overrides Uint8Array.prototype.slice (do a copy)</li>
</ul>

{% highlight ruby %}
const arr = new Uint16Array(2);
// Copies the contents of `arr`.
const buf1 = Buffer.from(arr);
// Shares memory with `arr`.
const buf2 = Buffer.from(arr.buffer);

// Iteration
const buf = Buffer.from([1, 2, 3]);
for (const b of buf) { console.log(b); }
{% endhighlight %}

<p><b><u>Strings</u></b></p>

<p>Created from string:</p>
{% highlight ruby %}
// the default encode is UTF8
// Cannot assume the string length match the converted buffer size
$ node -p "Buffer.from('Hello')"  // <Buffer 48 65 6c 6c 6f> :: charaters converted to byte
{% endhighlight %}

<p>Converting Buffers to String:</p>
{% highlight ruby %}
const buffer = Buffer.from('Hello')
console.log(buffer) // prints <Buffer 48 65 6c 6c 6f>
console.log(buffer.toString()) // prints Hello
console.log(buffer + '') // prints Hello
console.log(buffer.toString('hex')) // prints 48656c6c6f
console.log(buffer.toString('base64')) // prints SGVsbG8=
{% endhighlight %}

<p>Buffer instance can be represented by a JSON:</p>
{% highlight ruby %}
$ node -p "Buffer.from('Hello').toJSON()"          // { type: 'Buffer', data: [ 72, 101, 108, 108, 111 ] }
$ node -p "JSON.stringify(Buffer.from('Hello'))"   // {"type":"Buffer","data":[72,101,108,108,111]}
{% endhighlight %}

<h2 id="controlflow">Control flow (12%)</h2>
<h2 id="childprocess">Child Process (8%)</h2>
<h2 id="diagnostics">Diagnostics (6%)</h2>
<h2 id="error">Error Handling (8%)</h2>
<h2>Node.JS CLI (4%)</h2>
<h2>Events (11%)</h2>
<h2>File System (8%)</h2>
<h2>Module System (7%)</h2>
<h2>Process/Operating System (6%)</h2>
<h2>Package.json (6%)</h2>
<h2>Unit Testing (6%)</h2>

<br />
<h3>References</h3>
<ul>
  <li><a href="https://training.linuxfoundation.org/certification/jsnad/#domains">OpenJS Node.js Application Developer (JSNAD)</a></li>
   <li><a href="https://ravikirans.com/jsnad-openjs-nodejs-exam-study-guide/">JSNAD EXAM STUDY GUIDE (OPENJS NODE.JS APPLICATION DEVELOPER)</a></li>
   <li><a href="https://dev.to/kryz/node-js-certification-first-impressions-21a1">Node.js Certification: first impressions</a></li>
   <li><a href="https://nodejs.org/docs/latest-v20.x/api/index.html">Node.js Documentation</a></li>
   <li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript">Javascript (MDN)</a></li>
   <li><a href="https://www.npmjs.com/">NPM</a></li>
</ul>  
